### 一、引言

依赖(`dependency`)是别人为了解决一些问题而写好的代码，即我们常说的第三方包或三方库。

一个项目或多或少的会有一些依赖，而你安装的依赖又可能有它自己的依赖。

比如，你需要写一个 `base64` 编解码的功能，你可以自己写，但为什么要自己造轮子呢?大多数情况下，一个可靠的第三方依赖经过多方测试，兼容性和健壮性会比你自己写的更好。

项目中的依赖，可以是一个完整的库或者框架，比如 `react` 或 `vue`；可以是一个很小的功能，比如日期格式化；也可以是一个命令行工具，比如 `eslint`。

如果没有现代化的构建工具，即包管理器，你需要用`<script>`标签来引入依赖。

于是包管理器诞生了，用来管理项目的依赖。

它提供方法给你安装依赖(即安装一个包)，管理包的存储位置，而且你可以发布自己写的包。

### 二、npm v1-v2

初代 `npm(Node.js Package Manager)`随着 `Node.js` 的发布出现了，它的文件结构是嵌套的。

问题：`node_modules` 体积过大(大量重复的包被安装)、`node_modules` 嵌套层级过深(会导致 `windows` 文件路径过长的问题)

### 三、yarn & npm v3

当前的 yarn 与 npm 采用扁平化依赖管理（第一次出现的依赖逻辑上置于顶层，注意不关心版本，即不同版本的依赖不会都置于顶层）

在 `install` 安装时，会不停的往上级 `node_modules` 中寻找，如果找到同样的包，就不再重复安装，从而解决了大量包被重复安装的问题。

扁平化带来了新的问题：

- 依赖结构的不确定性
- 扁平化算法本身复杂性很高，耗时较长
- 项目中仍然可以非法访问没有声明过依赖的包（**幽灵依赖**）

```bash
 幽灵依赖:

 项目内的package.json内，没有安装对应依赖，比如没有install axios，但你在项目内可以使用axios。
 因为你依赖的A包里的package.json里的 dependencies 对象里 有axios
 幽灵依赖存在安全风险，比如依赖 A 某天不用 `axios` 了，改用 `fetch`，这时候如果升级了依赖 A，
 那 `node_modules` 里就没有 `axios` 了，代码直接 GG
```

于是出现 `yarn.lock`(`npm5` 才有 `package-lock.json`)，来保证 `install` 后产生确定的依赖结构。

但这并不能完全解决问题，`node_modules` 中依然存在各种不同版本的依赖

很容易出现协作时别人运行一次 `npm install` 后项目依旧跑不起来

### 四、pnpm

`pnpm(Performance npm)`的作者发现 `yarn` 并没有打算去解决上述的这些问题，于是另起炉灶，写了全新的包管理器。

`pnpm` 复刻了 `npm` 所有的命令，所以使用方法和 `npm` 一样，并且在安装目录结构上做了优化，特点是善用链接，且由于链接的优势，大多数情况下 `pnpm` 的安装速度比 `yarn` 和 `npm` 更快。

同一个包的同一个版本，全局只会装一次。一个包的不同版本，`pnpm` 也会极大程度地复用之前版本的代码。

放弃扁平化，`node_modules`的结构更漂亮， `package.json`基本所见即所得

### 五、bun

`bun CLI` 包含一个与 `Node.js` 兼容的包管理器，旨在极大地提高包的安装速度，可作为`npm、yarn`和`pnpm`的显著更快的替代品。它是一个独立的工具，适用于现有的 `Node.js` 项目；如果您的项目有一个`package.json`，则可以使用`bun install`来加速您的工作流程。

### 六、包管理常用命令

- `npm info antd` 查看组件版本
- `npm list xxx` 检查某依赖被重复安装了多少次

### 七、包管理常见需求

- 从 npm 删除未使用的安装包

  [npm-check](https://github.com/dylang/npm-check)

  全局安装： `npm install -g npm-check`

  使用：`npm-check`（适用于`npm/pnpm/yarn`）检查哪些包未使用

  注意这个插件并不完全可靠，仅作参考

- 升级依赖版本

  `npm-check -u`

  `yarn upgrade-interactive --latest` 命令（必须配合`yarn`）手动选择需要更新的版本，按空格键选择，a 键切换所有，i 键反选选择（最好一个一个来，不然容易出现网络问题）

- 2023.08.31更新

  <mark>不要频繁去更新依赖，重要的是不要轻易更新所有依赖，如果不确定能不能更新某依赖时，可以去官方的仓库里看有没有更新，否则会出现问题的。</mark>

  > 每一个注意事项，都是亲身淌过的浑水，踩过的坑。。。

- 安装依赖可以多试试几个包管理器，有的
- `pull`代码后，启动时一旦有依赖相关的报错，简单粗暴的方法就是删除所有依赖重新安装一遍

### 引用

> [聊聊前端包管理器对比 Npm、Yarn 和 Pnpm](https://www.51cto.com/article/702067.html) [一文看懂 npm、yarn、pnpm 之间的区别](https://juejin.cn/post/6844903616109641736) [前端依赖管理问题](https://juejin.cn/post/7217482458773209143) [bun](https://bun.sh/docs/cli/install)
