H5适配中主要使用媒体查询配合弹性布局

## 一、适配过程中遇到的样式问题

### 1、移动端开发1px像素线条变粗的原因与解决方法

> 苹果 iPhone4 首次提出了 Retina Display（视网膜屏幕）的概念，在 iPhone4 使用的视网膜屏幕中，把 2x2 个像素当 1 个物理像素使用，即使用 2x2 个像素显示原来 1 个物理像素显示的内容，从而让 UI 显示更精致清晰，这 2x2 个像素叫做**逻辑像素**。

> 像这种像素比（像素比（即dpr）＝ 物理像素 / 逻辑像素）为 2 的视网膜屏幕也被称为二倍屏，目前市面上还有像素比更高的三倍屏、四倍屏。

> 而 CSS 中 1px 指的是物理像素，因此，设置为 1px 的边框在 dpr = 2 的视网膜屏幕中实际占用了 2 个逻辑像素的宽度，这就导致了界面边框变粗的视觉体验。

原因：手机屏幕有设备像素比，比如iphone13的dpr是3，css里的1px逻辑像素会对应3个设备像素，导致边框变粗

最常用方案：伪元素 + transform

使用伪元素（如::before或::after）绘制1像素的线条，并通过transform缩放来调整其显示效果。还可以结合媒体查询（@media）解决不同 dpr 值屏幕的边框问题

```css
one-pixel-border {
  position: relative;
  box-sizing: border-box;
}

.one-pixel-border::before {
  display: block;
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 200%;
  height: 200%;
  border: 1px solid red;
  transform: translate(-50%, -50%) scale(0.5, 0.5);
}

@media screen and (-webkit-min-device-pixel-ratio: 2), (min-resolution: 2dppx) {
  ...
}

@media screen and (-webkit-min-device-pixel-ratio: 3), (min-resolution: 3dppx) {
  ...
}
```

### 2、图片模糊问题

- 方案1：非矢量图，2x、3x图适配（结合媒体查询）
- 方案2：使用SVG（矢量图不模糊）

### 3、刘海屏/安全区域适配

- `<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">` 开启全屏

  - viewport-fit=cover是让页面能接触到刘海区域

- 使用`env(safe-area-inset-top/bottom/left/right)` CSS变量，如`padding-top: env(safe-area-inset-top)`;

  - env()内边距把内容'推'到安全区域内

## 二、适配过程中遇到的交互问题

### 1、移动端滚动优化

- 滚动卡顿

  > PC端性能更强，浏览器对滚动优化也更成熟，而且PC端屏幕大，元素布局相对简单，重绘重排压力小。移动端设备性能有限，屏幕小导致元素密集，加上触摸滚动的即时性要求更高，一旦有复杂操作就容易卡顿。

  `-webkit-overflow-scrolling:touch` 这个属性可以实现启用**弹性滚动**，手指离开屏幕会惯性滑动一段距离,从而让滚动变的丝滑

- 滚动花屏（滑动时出现空白，即图片不显示，影响布局）

  `-webkit-transform: translateZ(0px)` 开启了 3D 渲染，强制开启 GPU 渲染解决了相关渲染问题

- 滚动穿透（写弹窗的时候经常会遇到，滑着滑着把弹窗下面的东西也滑动了）

  在弹窗的滚动区域设置`overscroll-behavior: contain`,当滚到边缘时，阻止滚动冒泡到父元素（body）。

### 2、键盘弹起布局问题

将输入框改为position:fixed（在安卓机上调出键盘时，对话列表需要滑动到最底部，不然也会被遮挡）

## 三、**布局**适配问题

### 1、响应式布局方案（移动端响应式布局怎么做）

- 媒体查询（针对不同屏幕调整细节，比如小屏时隐藏侧边栏）
- Flex弹性布局（适合组件内元素的排列，比如不同区域的占比分配）
- Grid网格布局（用得比较少，如果要实现栅格划分，常用antd的row/col组件，能快速做响应式的列宽分配）

### 2、横竖屏适配

了解基本思路，主要是通过媒体查询检测屏幕方向，调整布局排列方式和尺寸，保证横屏时内容不拥挤

## 四、性能优化

AI智能客服本身首屏比较轻量化

移动端首屏优化可以侧重**精简JS**，比如用Vite的Tree-shaking去掉没用的代码。毕竟聊天界面主要是JS逻辑，优化这些点效果会更明显。

## 引用

> [面试官：说说设备像素、css像素、设备独立像素、dpr、ppi 之间的区别？](https://vue3js.cn/interview/css/dp_px_dpr_ppi.html#%E4%B8%80%E3%80%81%E8%83%8C%E6%99%AF)
