### 一、概念

构建工具在工程里负责什么？（构建工具主要负责**开发阶段的效率**和**生产构建的稳定性**。）

- 开发阶段：主要关注启动速度、热更新和联调体验
  - 本地服务
  - 模块解析
  - 热更新
- 生产阶段：更关注打包体积、代码拆分和稳定性
  - 打包
  - 代码拆分
  - 静态资源处理
- Vite 在开发阶段基于原生 ES module，启动和热更新更快；webpack 是统一打包模型，在大型项目中生态和兼容性更成熟。

#### 1、tree shaking

Tree Shaking 是一种用于移除 JavaScript 中未使用代码（dead code）的技术，它通常在**构建**过程中的**代码优化**阶段执行。这个术语最早来源于 ES6 模块打包工具**Rollup**，但现在也被广泛应用于其他打包工具如 Webpack 和 Vite。

- 工作原理：

  - 静态分析：Tree Shaking 依赖于 ES6 模块的静态结构。这意味着导入和导出语句在编译时就可以确定，不需要在运行时动态解析。
  - 标记未使用代码：通过静态分析，打包工具可以识别出哪些模块和代码片段在最终的应用中并未被实际使用。
  - 移除未使用代码：在打包过程中，这些未使用的代码将被移除，从而减小最终包的大小。

- 实现步骤：

  - 使用 ES6 模块语法：确保代码使用 ES6 的 import 和 export 语法，因为 CommonJS 的 require 语法是动态的，无法进行静态分析。
  - 配置打包工具：确保打包工具（如 Webpack 或 Rollup）正确配置以支持 Tree Shaking。

    - 对于 Webpack，需要在 mode 设置为 production，并且在 package.json 中使用 "sideEffects": false 或指定具体的副作用文件。

      > 当在 package.json 中设置 "sideEffects": false 时，表示整个项目的所有模块在被导入时不会产生副作用。这意味着，如果某个模块的导出内容未被其他模块引用，打包工具可以在打包过程中安全地将其移除，而不必担心移除该模块会对程序的运行产生不良影响。需要注意的是，这种配置适用于那些纯函数式的模块，即模块内部的代码在导入时不会对外部状态产生任何影响。如果模块中包含诸如修改全局变量、添加全局样式、或进行其他全局性操作的代码，则不应将其标记为无副作用。

    - 对于 Rollup，默认支持 Tree Shaking，但可以通过一些插件如 rollup-plugin-terser 进行进一步优化。

  - 运行构建：在构建过程中，打包工具会自动进行 Tree Shaking，并生成优化后的代码包。

#### 2、为什么vite速度比webpack快？

<mark>Vite开发阶段不做整体打包，而是利用浏览器的模块加载能力，实现按需编译。</mark>

<mark>总的来说，Vite 之所以比 Webpack 快，主要是因为它采用了不同的开发模式、充分利用了现代浏览器的 ES Modules 支持、使用了更高效的底层语言，并优化了热更新的处理。这些特点使得 Vite在大型项目中具有显著的优势，能够快速启动和构建，提高开发效率。</mark>

- 在开发环境中，Webpack 是先打包再启动开发服务器，而 Vite 则是直接启动，然后再按需编译依赖文件。（可以启动项目后检查源码 Sources 那里看到）
- 现代浏览器本身就支持 ES Modules，会主动发起请求去获取所需文件。Vite充分利用了这一点，将开发环境下的模块文件直接作为浏览器要执行的文件，而不是像 Webpack 那样先打包，再交给浏览器执行。这种方式减少了中间环节，提高了效率。

  > 通过使用 export 和 import 语句，ES Modules 允许在浏览器端导入和导出模块。当使用 ES Modules 进行开发时，开发者实际上是在构建一个**依赖关系图**，不同依赖项之间通过导入语句进行关联。

- 底层语言的差别：Webpack 是基于 Node.js 构建的，而 Vite 则是基于 esbuild 进行预构建依赖。esbuild 是采用 Go 语言编写的，Go 语言是纳秒级别的，而 Node.js 是毫秒级别的。因此，Vite 在打包速度上相比Webpack 有 10-100 倍的提升。

- 热更新的处理：在 Webpack 中，当一个模块或其依赖的模块内容改变时，需要重新编译这些模块。而在 Vite 中，当某个模块内容改变时，只需要让浏览器重新请求该模块即可，这大大减少了热更新的时间。

### 二、关于vite

#### 1、常用vite配置

proxy、alias

#### 2、代码拆分

Vite 中的代码拆分是基于 **Rollup** 的，这是 Vite 底层打包工具的一个选择。Rollup 可以将你的代码拆分成多个小的模块，然后在需要的时候再异步加载。这种技术有助于改善用户体验，尤其是对于那些具有大型应用程序的网站。

### 三、关于webpack

目前现状：主要使用的是 Vite，但 webpack 的核心概念有了解，比如 loader、plugin、打包流程。如果遇到问题可以快速定位和调整配置。

#### 1、webpack 里的 loader 和 plugin 有什么区别？

loader 负责处理不同类型的模块，把它们转换成可打包的资源；plugin 更偏向在构建流程中做整体扩展，比如优化、注入变量等。

#### 2、项目构建慢 / 体积大，怎么排查？

先区分是开发还是生产阶段的问题，再从依赖体积、是否按需引入、是否存在重复依赖这些方向排查。

### 引用

> [Webpack面试题](https://juejin.cn/post/6844904094281236487)[9个常见的 Webpack 面试题，中高级前端必会！](https://juejin.cn/post/7157998164627161095)
