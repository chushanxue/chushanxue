### 一、APP分类

表面上看，手机 App 都是同样的东西，就是手机上的应用程序，点击图标就能运行，但是它们的底层技术不一样。按照开发技术，App 可以分成三大类：

- 原生应用（native application，简称 native App）
- Web 应用（web application，简称 Web App）
- 混合应用（hybrid application，简称 hybrid App）

  ![ ](/md/h5导论/1.webp)

### 二、原生 App

原生 App专门为特定手机平台开发的应用程序 ，无法在其他平台运行。一个手机软件如果要同时支持苹果手机和安卓手机，就需要为它们各写一个原生 App。

原生 App 使用与手机操作系统相同的语言。iOS 的原生 App 使用 Objective-C 语言或 Swift 语言，安卓使用 Java 语言或 Kotlin 语言。由于跟底层系统的语言和技术模型一致，所以原生 App 的性能和用户体验都很好。

- 优点
  - 较好的性能和体验
  - 可以使用系统的所有硬件和软件 API，比如 GPS、摄像头、麦克风、加速计、通知推送等等，能充分发挥系统的潜力
- 缺点
  - 成本，每个手机平台都要建立一个独立的开发团队，大公司一般都有 iOS 和安卓两个开发团队。如果出现第三个平台，就要组建第三个团队，成本就更高。
  - 原生 App 使用底层操作系统的语言，都是很重的编译型语言，开发和调试成本相对较高，时间周期长。
  - 原生 App 必须下载安装才能使用，只要升级版本，就必须重新下载安装。用户往往不愿意更新版本，厂商被迫不得不长期支持很久以前的旧版本。

### 三、Web 应用

Web App 是使用网页做的应用程序，必须在浏览器中使用。

Web App 主要使用网页技术，即 HTML、JavaScript 和 CSS。2008年，w3c 组织发布了 HTML 第5版，简称 <mark>HTML 5，该版本大大增强了网页的功能，使得网页可以当作应用程序使用，而不仅仅是展示文字和图片，这就是 Web App 的由来。</mark>

- 优点
  - 不需要下载安装，打开浏览器就能使用，而且总是使用最新版
  - 对于开发者来说，Web App 写起来比较快，调试容易，不需要应用商店的批准就能发布。
- 缺点
  - 浏览器提供的 API（即 Web API）很有限（目前只有相机、GPS、电池等少数几个），大部分系统硬件都不能通过网页访问，也无法直接读取硬盘文件，所以 Web App 无法充分利用平台的硬件。
  - 网页通过浏览器渲染，性能不如原生 App，不适合做性能要求较高的页面。

另有三大缺陷阻碍它的推广：

- 不能从手机的首屏直接进入。
- 缺乏手机状态栏和锁屏时的通知推送能力。
- 不支持脱机访问（即断网也能使用）

> 为了解决这些问题，Chrome 团队开发了新技术"渐进式 Web App"（Progressive Web App，缩写 PWA）。它可以把网站缓存在手机里面，供离线时使用，还能在手机首屏生成图标，直接点击进入，并且有通知推送能力，也不带有浏览器的地址栏和状态栏，跟原生 App 的使用体验非常接近。但是，PWA 需要浏览器访问一次网站，才能在首屏生成图标，并且目前 iOS 系统的支持还不够理想，所以还只是一项探索性质的技术，迄今为止缺乏足够的成功案例。

### 四、原生 App与Web 应用的比较

Web App 需要打开浏览器才能使用，这意味着，用户必须记住如何导航到它，要么直接输入网址，要么翻找书签。这使得进入 Web App，远不如原生 App 方便。这点很致命，事实表明，用户偏好原生 App。

谷歌曾经调查了原生 App 和 Web App 各一千个，发现 <mark>Web App 可以覆盖更多的用户（1100万 vs 400万），但是原生 App 的用户使用时间（188分钟）远超 Web App（9分钟）。</mark>

> 用户的 App 使用时间都被头部 App 占据了，小公司的 App 使用频率非常低，获客成本极高，最终变成僵尸 App。因此，小公司开发 Web App 更划算，不仅成本低，而且可以服务更多的用户，以及更好地宣传自己（可以被搜索引擎收入）。

### 五、混合应用

混合 App （hybrid App）顾名思义就是原生 App 与 Web App 的结合。它的壳是原生 App，但是里面放的是网页。 可以理解成，**混合 App 里面隐藏了一个浏览器，用户看到的实际上是这个隐藏浏览器渲染出来的网页。**

结构上，混合 App 从上到下分成三层：<mark>HTML5 网页层、网页引擎层、容器层。</mark>

- HTML5 网页层

  即传统的html css js三件套

- 网页引擎层

  本质上是一个隔离的浏览器实例

- 容器层

  混合 App 的原生外壳称为"容器"，内部隐藏的浏览器，通常使用系统提供的网页渲染控件（即 WebView 控件），也可以自己内置一个浏览器内核。

> 混合 App 里面的网页不同于普通网页，可以调用底层系统所有的 API。奥秘就在于外层容器提供了 API Bridge，充当底层 API 的中介，允许内部的网页调用底层。

> 所谓 API Bridge 就是容器在底层接口和网页之间，建立一座桥梁，让双方通信。容器一旦接到网页的请求，就根据请求去调用底层系统的 API，然后再返回结果给网页。API Bridge 往往以 JavaScript 语言提供，方便网页调用，这时又称为 JSbridge。

- 优点
  - **跨平台**：Web 技术是**跨平台**的，开发者只写一次页面，就能支持多个平台。也就是说，混合 App 只需要一个团队就够了，开发成本较低。
  - **灵活性**：混合 App 的**灵活性**大，很容易集成多种功能。一方面，混合 App 很容易加载外部的 H5 页面，实现 App 的插件结构；另一方面，Web 页面可以方便地调用外部的 Web 服务。
  - **开发方便**：Web 页面的调试和构建，远比原生控件简单省时。页面的更新也容易，只要在服务器上发布新版本，触发容器内更新就可以了。另外，Web 开发人员也比较容易招聘，传统的前端程序员可以承担开发任务。
- 缺点
  - 由于存在网页引擎的中间层，所以性能比较欠缺，不仅不如原生 App，而且由于 WebView 不是全功能浏览器，可能比 Web App 都要慢一些。
  - 由于页面跨平台，就无法使用只有特定平台提供的功能，导致体验不如纯的原生 App。举例来说，早期的时候，安卓有物理的后退按钮，iPhone 没有，页面设计不得不考虑这一点。

### 六、混合应用相关技术

混合技术栈指的是开发混合 App 的技术，也就是**把 Web 网页放到特定的容器中，然后再打包成各个平台的原生 App**。所以，混合技术栈其实是 Web 技术栈 + 容器技术栈

#### 1、WebView 控件

不管什么技术，最终在 App 里面显示网页，一定需要一个**网页引擎**，这样才能解析网页。

通常情况下，App 内部会使用 WebView 控件作为网页引擎。这是系统自带的控件，专门用来显示网页。应用程序的界面，只要放上 WebView，就好像内嵌了浏览器窗口，可以显示网页。

不同的 App 技术栈要显示网页，区别仅仅在于怎么处理 WebView 这个原生控件。

<mark>这个控件在我们开发H5页面时是无感知的，我们只需要提供一个链接，由手机平台方去内嵌H5页面</mark>

#### 2、API Bridge

API Bridge是一种在移动应用程序中实现原生代码与Web代码之间通信的机制。它允许您在WebView中的网页代码和应用程序的原生代码之间进行相互调用和数据传递。

- 对于应用程序方：可以定义一组接口或方法，使网页代码能够调用应用程序的原生功能，并且应用程序的原生代码也可以通过API Bridge将数据传递给网页。
- 对于web网页方：可以通过JavaScript来调用原生方法

#### 3、实战案例

- 首先将npm或者pnpm的仓库切换到内网（这是因为大部分公司自有的API Bridge不会放到公网仓库）

  pnpm set registry xxx（或者打开.npmrc文件，这里也可以设置）

- 找到sdk文档并引用对应的包

  由于只有本页需要嵌入到H5，所以直接在本页引用即可

  ```js

  import { xxx } from 'xxx-js-sdk';
  // 这段可以放到usemount中
   xxx
      .getUserBasic()
      .then(res => {})
      .catch(err => {
        if(err.data?.code === ECode.fail) {
          ...
        }
      })
  ```

- 使用vconsole方便调试

  `pnpm add vconsole -D`

  ```js
  // app.ts
  import VConsole from 'vconsole';
  const isProd = window.location.host === 'xxx.com';

  if (!isProd) {
    // 生效的关键
    new VConsole();
  }
  ```

- 拿到测试软件包

  ![ ](/md/h5导论/2.png)

  虽然正式软件包也可以通过扫描测试环境网页看到用户信息，但是，生产环境调用测试接口，所用token是不匹配的，所以我们还需要拿到测试软件包，注册一个账号，通过扫一扫，扫描网页端生成的二维码，就可以开始测试了

- 小tips

  H5中打开网页链接，导航栏显示的标题就是页签标题，既然想更改这个标题文字，就直接将对应路由页面的页签标题改掉即可，无需用到sdk

  ```js
  // umi更改页签标题组件
  <Helmet>
    <title>xxx</title>
  </Helmet>
  ```

### 七、小程序

所谓小程序，可以看作是针对特定容器的 H5 开发。微信本身是一个容器，开放自己的接口（JSbridge），外部开发者使用规定的语法，编写页面，容器可以动态加载这些页面。

小程序对于微信官方的好处是，扩展了功能和应用场景，吸引外部开发者加入，繁荣了生态。对于外部开发者的好处是，有了流量入口，可以直接调用微信的各种功能（比如支付）。
