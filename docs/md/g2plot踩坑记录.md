### ä¸€ã€å‰è¨€

æ–‡æ¡£ï¼š<https://g2plot.antv.antgroup.com/examples>

è¿™ç±»å›¾è¡¨æ–‡æ¡£æ€»æœ‰ä¸€ä¸ªé€šç—…ï¼šå°±æ˜¯å¾ˆéš¾æ‰¾åˆ°æƒ³ä¿®æ”¹çš„å±æ€§ï¼Œä¸çŸ¥é“æ˜¯æˆ‘çš„é—®é¢˜è¿˜æ˜¯æ–‡æ¡£æœ¬èº«å°±å†™å¾—å¾ˆçƒ‚

å¦å¤–ä½¿ç”¨æ¡†æ¶æ—¶å’Œå®˜ç½‘ç»™çš„ç¤ºä¾‹å°±å¯¹ä¸ä¸Šäº†ï¼Œéœ€è¦é¢å¤–çš„æ€è€ƒ

### äºŒã€è®°å½•

#### 1ã€åœ¨reactä¸­çš„ä½¿ç”¨

ä»¥åŸºç¡€æŠ˜çº¿å›¾ä¸ºä¾‹

- å®˜ç½‘ç¤ºä¾‹

  ```js
  import { Line } from '@antv/g2plot';

  const line = new Line('container', {
    data,
    ...
  });

  line.render();
  ```

- reactç”¨æ³•

  ä¿è¯æ¯æ¬¡**åˆ·æ–°**æ‹¿åˆ°æœ€æ–°çš„æ•°æ®å¹¶æ¸²æŸ“

  ```js
    import React, { useEffect } from 'react';
    import { Line } from '@antv/g2plot';

    const LineChart: React.FC<{ data: [] }> = ({ data }) => {
    // æå‰æ¸²æŸ“ä¼šå¯¼è‡´å›¾è¡¨æœ€å¸¸è§çš„å´©æºƒç°è±¡ï¼šé¡µé¢æ— é™æ‹‰é•¿ç›´åˆ°å´©æºƒ
    // å› ä¸ºæ‹¿åˆ°dataå’Œç»„ä»¶æ¸²æŸ“çš„æ—¶æœºæ— æ³•ç¡®å®šï¼Œæ‰€ä»¥å†™åœ¨useEffectä¸­é¿å…æå‰æ¸²æŸ“
    useEffect(() => {
        // è¿™å¥ä¹Ÿæ˜¯é¿å…æå‰æ¸²æŸ“å¿…ä¸å¯å°‘çš„ï¼Œå°‘äº†å°±è·Ÿä¸å†™useEffectæ²¡æœ‰åŒºåˆ«
        if (data.length === 0) return;
        const line = new Line('container1', {
            data,
            ...
        });
        line.render();
    }, [data]);

    return <div id="container1"></div>;
    };

    export default LineChart;
  ```

  ä¿è¯**ä¸åˆ·æ–°**ä¹Ÿèƒ½æ‹¿åˆ°æœ€æ–°çš„æ•°æ®å¹¶æ¸²æŸ“

  ```js
    import React, { useEffect, useRef } from 'react';
    import { Column } from '@antv/g2plot';
    import { useMount } from 'ahooks';

    const LabelColumn: React.FC<{ data: [] }> = ({ data }) => {
    // éœ€è¦ä½¿ç”¨useRefå®šä¹‰å…ƒç´ 
    const columnPlotRef = useRef<Column>();

    // é¿å…æå‰æ¸²æŸ“
    useMount(() => {
        columnPlotRef.current = new Column('container4', {
            data,
            ...
        });
        // renderåªåœ¨åˆå§‹æ—¶è°ƒç”¨
        columnPlotRef.current.render();
    });

    useEffect(() => {
        if (columnPlotRef.current) {
            // dataå˜åŠ¨æ—¶åªè°ƒç”¨changeData
            columnPlotRef.current.changeData(data);
        }
    }, [data]);

    return <div id="container4"></div>;
    };

    export default LabelColumn;
  ```

#### 2ã€æ¸²æŸ“é—®é¢˜

- å¤šä¸ªå›¾è¡¨çš„idä¸å¯é‡å¤ğŸ™…ğŸ»â€â™€ï¸

#### 3ã€è¯¦ç»†é…ç½®é—®é¢˜

- æ ‡ç­¾æ¢è¡Œ

  ![ ](/md/g2plotè¸©å‘è®°å½•/1.png)

  ```js
   legend: {
        flipPage: false, //å…³é—­ç¿»é¡µ
    },
  ```

- æ ‡ç­¾é‡å 

### ä¸‰ã€é¢è¯•è€ƒç‚¹å‡†å¤‡ï¼ˆå«echartsã€g2plotï¼‰

#### 1ã€EChartså’ŒAntVè®¾è®¡ä¸Šæœ‰ä»€ä¹ˆæ ¹æœ¬åŒºåˆ«ï¼Ÿ

- ECharts
  - é…ç½®é©±åŠ¨ (Configuration-Driven)
  - å¼€ç®±å³ç”¨ï¼Œé€šè¿‡é…ç½®å¯¹è±¡æè¿°å›¾è¡¨
  - åƒç»„è£…ä¹é«˜ï¼Œç»™ä½ é¢„åˆ¶çš„ç»„ä»¶ï¼ŒæŒ‰è¯´æ˜ä¹¦æ‹¼è£…
- AntV
  - å£°æ˜å¼è¯­æ³• (Declarative Grammar)
  - å›¾å½¢è¯­æ³•ï¼Œæ•°æ®åˆ°å›¾å½¢çš„æ˜ å°„
- AntV_G2plot
  - é…ç½®é©±åŠ¨ + è¯­æ³•ç³–
  - åœ¨G2åŸºç¡€ä¸Šå°è£…ï¼Œæä¾›ç±»ä¼¼EChartsçš„é…ç½®API

#### 2ã€æŠ€æœ¯é€‰å‹è€ƒé‡

- ç¤¾åŒºã€æ–‡æ¡£æ˜¯å¦å…¨é¢
- æ€§èƒ½ï¼šåŠ è½½å¤§æ•°æ®é‡çš„èƒ½åŠ›
- æ¡†æ¶æ˜¯å¦æœ‰æŒç»­æ›´æ–°
- å…¬å¸å†…éƒ¨æ˜¯å¦æœ‰ä½¿ç”¨
- æ»¡è¶³ä¸šåŠ¡éœ€æ±‚

å› ä¸ºå›¢é˜ŸUIåŸºäºAnt Designå®šåˆ¶ï¼ŒAntVçš„G2Plotå’Œç°æœ‰UIè®¾è®¡ç¨¿é£æ ¼ç»Ÿä¸€ï¼Œä¸ç”¨é¢å¤–è°ƒæ•´æ ·å¼ï¼Œè€Œä¸”G2Plotæ–‡æ¡£æ¸…æ™°ï¼Œèƒ½å¿«é€Ÿå®ç°æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾è¿™äº›ä¸šåŠ¡éœ€è¦çš„å›¾è¡¨ï¼Œæ‰€ä»¥é€‰äº†å®ƒã€‚

#### 3ã€g2plots

"G2Plot"ä¸­çš„ G2 å³æ„æŒ‡å›¾å½¢è¯­æ³• (the Gramma of Graphics)

- å¼€ç®±å³ç”¨ã€é»˜è®¤å¥½ç”¨çš„é«˜è´¨é‡ç»Ÿè®¡å›¾è¡¨
- æç‚¼è‡ªä¼ä¸šçº§äº§å“çš„è§†è§‰è¯­è¨€å’Œè®¾è®¡è§„èŒƒ
- å“åº”å¼å›¾è¡¨ï¼šè‡´åŠ›äºè§£å†³å›¾è¡¨åœ¨ä»»ä½•æ•°æ®å’Œæ˜¾ç¤ºå°ºå¯¸ä¸‹çš„åŸºæœ¬å¯è¯»æ€§é—®é¢˜
- å›¾å±‚åŒ–è®¾è®¡æ–¹æ³•ï¼šåœ¨ G2Plot ä½“ç³»ä¸‹ï¼Œå›¾è¡¨ä¸ä»…ä»…åªæ˜¯å„ä¸ç›¸å…³çš„å®ä¾‹ï¼Œå›¾å±‚æ¦‚å¿µçš„å¼•å…¥æä¾›äº†å¤šå›¾è¡¨ç»„åˆå è”åŠ¨ï¼Œå…±åŒè®²è¿°ä¸€ä¸ªæ•°æ®æ•…äº‹çš„å¯èƒ½æ€§

#### 4ã€å¤§æ•°æ®æ¸²æŸ“ä¼˜åŒ–

- æ•°æ®èšåˆï¼šæ¯”å¦‚æŒ‰å¤©æ±‡æ€»**å°æ—¶çº§æ•°æ®**ï¼Œå‡å°‘æ•°æ®ç‚¹æ•°é‡ã€‚
- å¦å¤–G2Plotæœ¬èº«æœ‰å†…ç½®çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å¼€å¯canvasæ¸²æŸ“æ¨¡å¼ï¼Œæˆ–è€…è®¾ç½®samplingé‡‡æ ·é…ç½®ï¼Œè¿™äº›éƒ½èƒ½æå‡å¤§æ•°æ®é‡ä¸‹çš„æ¸²æŸ“é€Ÿåº¦ã€‚
- é€šè¿‡**useEffect**ä¾èµ–æ•°ç»„æ§åˆ¶å›¾è¡¨**é‡ç»˜**æ—¶æœºï¼Œåªåœ¨æ•°æ®æ›´æ–°æ—¶æ‰é‡æ–°æ¸²æŸ“ï¼Œé¿å…æ— æ•ˆé‡ç»˜ï¼ˆè€Œä¸”èƒ½é¿å…æ¥å£å¼‚æ­¥æ— æ•°æ®å‰çš„æ ·å¼é—®é¢˜ï¼‰

#### 5ã€å›¾è¡¨ç»„ä»¶å°è£…ç»éªŒ

> æ¯”å¦‚åœ¨AIæ•°æ®çœ‹æ¿é‡Œï¼Œéœ€è¦å¤šå¤„å±•ç¤ºä¸åŒç»´åº¦çš„æ—¶é—´è¶‹åŠ¿æ•°æ®ï¼Œåƒ**æ ‡æ³¨é‡æŒ‰æ—¥è¶‹åŠ¿ã€å®¡æ ¸é‡æŒ‰æ—¥è¶‹åŠ¿**ï¼Œè¿™æ—¶å€™å°è£…æŠ˜çº¿å›¾ç»„ä»¶ï¼Œæ¥æ”¶xè½´å­—æ®µã€yè½´å­—æ®µå’Œæ•°æ®ï¼Œå°±èƒ½åœ¨ä¸åŒåœ°æ–¹å¤ç”¨ï¼Œä¸ç”¨é‡å¤å†™é…ç½®ã€‚è€Œä¸”å›¢é˜ŸUIç»Ÿä¸€ï¼Œå°è£…æ—¶æŠŠAnt Designçš„ä¸»é¢˜æ ·å¼å†…ç½®è¿›å»ï¼Œå¤ç”¨çš„æ—¶å€™ç›´æ¥ä¼ æ•°æ®å°±è¡Œï¼Œç¬¦åˆä¸šåŠ¡é‡Œâ€œå¿«é€Ÿæ­å»ºå¤šä¸ªè¶‹åŠ¿å›¾è¡¨â€çš„éœ€æ±‚ã€‚

- ä¸»è¦ä»UIå±‚é¢å’Œä¸šåŠ¡é€»è¾‘å±‚é¢è€ƒè™‘ï¼Œå°è£…è¿‡é€šç”¨ä¸šåŠ¡çš„æŠ˜çº¿å›¾

- â­â­â­å°è£…æ—¶ç”¨äº†Reactçš„useRefå­˜å›¾è¡¨å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚

  - æ€§èƒ½é—®é¢˜
  - é—ªçƒé—®é¢˜ï¼ˆå›¾è¡¨å¹³æ»‘è¿‡æ¸¡åˆ°æ–°æ•°æ®ï¼Œæ— é—ªçƒï¼Œä½“éªŒå¥½ï¼Œä¸ä¼šå‡ºç°å›¾è¡¨æ¶ˆå¤±ã€ç™½å±æˆ–ç©ºç™½çš„é—ªçƒé—®é¢˜ï¼‰
  - çŠ¶æ€ä¸¢å¤±ï¼ˆåªæ›´æ–°æ•°æ®ä¿ç•™ï¼šæ‰€æœ‰äº¤äº’çŠ¶æ€ï¼ŒåŠ¨ç”»è¿ç»­æ€§ï¼Œç”¨æˆ·æ“ä½œè®°å½•ï¼‰

- propsæ¥æ”¶æ•°æ®å’ŒåŸºç¡€é…ç½®ï¼Œæ¯”å¦‚xè½´å­—æ®µã€yè½´å­—æ®µï¼Œåœ¨useEffecté‡Œç›‘å¬æ•°æ®å˜åŒ–ï¼Œè°ƒç”¨chart.changeDataæ›´æ–°ã€‚

- è¿˜å¤„ç†äº†ç»„ä»¶å¸è½½æ—¶é”€æ¯å®ä¾‹ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

- å¦å¤–å°±æ˜¯ï¼Œå°è£…æ—¶åŠ è¿‡é€šç”¨çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚å›¾è¡¨æ ‡é¢˜æˆ–è€…å›¾ä¾‹ä½ç½®

```jsx
// æœ€ç®€å•çš„æŠ˜çº¿å›¾ç»„ä»¶
import React, { useEffect, useRef } from 'react';
import { Line } from '@antv/g2plot';

const SimpleLineChart = ({
  data = [],
  xField = 'x',
  yField = 'y',
  title = '',
  width = '100%',
  height = '400px',
}) => {
  const containerRef = useRef(null);
  const chartRef = useRef(null);

  // 1. åˆå§‹åŒ–å›¾è¡¨
  useEffect(() => {
    // é‡è¦æ£€æŸ¥ï¼šç¡®ä¿å®¹å™¨å­˜åœ¨
    if (!containerRef.current) return;

    // æ­£ç¡®å†™æ³•ï¼šå¦‚æœå·²ç»æœ‰å®ä¾‹ï¼Œç›´æ¥è·³è¿‡
    if (chartRef.current) {
      console.log('å›¾è¡¨å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤åˆå§‹åŒ–');
      return; // ç›´æ¥è¿”å›ï¼Œä¸é‡å¤åˆ›å»º
    }

    // åˆ›å»ºå›¾è¡¨å®ä¾‹ï¼ˆåªæ‰§è¡Œä¸€æ¬¡ï¼‰
    chartRef.current = new Line(containerRef.current, {
      data,
      xField,
      yField,
      smooth: true,
    });

    // æ¸²æŸ“
    chartRef.current.render();

    // 2. æ¸…ç†å‡½æ•°
    return () => {
      if (chartRef.current) {
        chartRef.current.destroy();
        chartRef.current = null; // æ¸…é™¤å¼•ç”¨
      }
    };
  }, []); // ç©ºæ•°ç»„ï¼šåªæ‰§è¡Œä¸€æ¬¡

  // 3. æ•°æ®æ›´æ–°
  useEffect(() => {
    // é‡è¦æ£€æŸ¥ï¼šç¡®ä¿å›¾è¡¨å®ä¾‹å’Œæ•°æ®éƒ½å­˜åœ¨
    if (!chartRef.current || !data || data.length === 0) return;

    chartRef.current.changeData(data);
  }, [data]);

  return (
    <div style={{ width, height }}>
      {title && <h4 style={{ textAlign: 'center' }}>{title}</h4>}
      <div
        ref={containerRef}
        style={{
          width: '100%',
          height: title ? 'calc(100% - 30px)' : '100%',
        }}
      />
    </div>
  );
};

export default SimpleLineChart;
```

#### 6ã€å›¾è¡¨è‡ªé€‚åº”å±å¹•

- åŸºç¡€è‡ªé€‚åº”

  ```js
  chartRef.current = new Line(containerRef.current, {
    data,
    xField: 'date',
    yField: 'value',
    autoFit: true, // G2Plotè‡ªå¸¦è‡ªé€‚åº”
  });
  ```

- å“åº”å¼å¸ƒå±€é…åˆCSS

  æ¯”å¦‚åœ¨å°å±å¹•ä¸‹æŠŠå›¾è¡¨é«˜åº¦ä»400pxæ”¹æˆ300px
